import { useState, useEffect } from 'react';

// —Ö—É–∫ –ø–∏—à–µ—Ç –∏ –≤ —Å—Ç–µ–π—Ç, –∏ –≤ –õ–°. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∫–ª—é—á–∞ –≤ –õ–° –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –Ω–µ—Ç –ª–∏ —Ç–∞–∫–æ–≥–æ —É–∂–µ.

// –ø—Ä–æ–≤–µ—Ä—è–µ—Ç —Å–æ–¥–µ—Ä–∂–∏—Ç –ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è —á—Ç–æ-—Ç–æ –≥–æ–¥–Ω–æ–µ
function isDefined(storedValue) {
  // –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç true –µ—Å–ª–∏ –∞—Ä–≥—É–º–µ–Ω—Ç –Ω–µ –ø—É—Å—Ç –ò –µ—Å–ª–∏ –æ–Ω –Ω–µ undefined.
  return storedValue !== null && storedValue !== 'undefined';
}

export default function useStorage(key, initialValue) {
  // 1—è —á–∞—Å—Ç—å –≤–æ—Å—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø—Ä–∏ –º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏ –∏ –ø–µ—Ä–µ–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
  const [state, setState] = useState(() => {
    const storedValue = localStorage.getItem(key);

    // –µ—Å–ª–∏ –≤ –õ–° –≥–æ–¥–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ, —Ç–æ –≤–æ–∑–≤—Ä–∞—â–∞—é –µ–≥–æ –≤ —Å—Ç–µ–π—Ç.
    // –ò–Ω–∞—á–µ –≤–æ–∑–≤—Ä–∞—â–∞—é –∏–∑–Ω–∞—á–∞–ª—å–Ω–æ–µ –∏–∑ –∞—Ä–≥—É–º–µ–Ω—Ç–∞ –≤ —Å—Ç–µ–π—Ç.
    return isDefined(storedValue) ? JSON.parse(storedValue) : initialValue;
    // –¢.–∫. –≤ –õ–° –≤—Å—ë —Ö—Ä–∞–Ω–∏—Ç—Å—è –≤ —Å—Ç—Ä–æ–∫–∞—Ö, –Ω—É–∂–Ω–æ –ø–∞—Ä—Å–∏—Ç—å –≤—Å—ë, —á—Ç–æ –∏–∑ –Ω–µ–≥–æ –±–µ—Ä—É
    // –ß—Ç–æ–±—ã –Ω–µ—Å—Ç—Ä–æ–∫–æ–≤—ã–µ —Ç–∏–ø—ã –Ω–µ –æ—Å—Ç–∞–≤–∞–ª–∏—Å—å —Å—Ç—Ä–æ–∫–æ–≤—ã–º–∏ –ø–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –∏–∑ –õ–°
  });

  // 2—è —á–∞—Å—Ç—å –¥—É–±–ª–∏—Ä—É–µ—Ç —Å—Ç–µ–π—Ç –≤ –õ–°
  useEffect(() => {
    localStorage.setItem(key, JSON.stringify(state));
  }, [key, state]);

  // 3—è —á–∞—Å—Ç—å - –≤–æ–∑–≤—Ä–∞—â–∞–µ–º —Å—Ç–µ–π—Ç –∏ —Ñ—É–Ω–∫—Ü–∏—é –µ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è.
  // üü° –Ω–µ–ø–æ–Ω—è—Ç–Ω–∞—è —á–∞—Å—Ç—å.
  return [state, setState];
}
